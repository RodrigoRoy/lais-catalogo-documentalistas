<template>
    <div ref="chartContainer" with="500" height="500" class="flex justify-center"></div>
</template>

<script>
    import * as d3 from 'd3';
    import cloud from 'd3-cloud';

    export default {
        async mounted() {
            let words = [
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "documental",
                "méxico",
                "méxico",
                "méxico",
                "méxico",
                "méxico",
                "méxico",
                "méxico",
                "méxico",
                "méxico",
                "méxico",
                "méxico",
                "mujeres",
                "mujeres",
                "mujeres",
                "mujeres",
                "mujeres",
                "mujeres",
                "mujeres",
                "mujeres",
                "pueblo",
                "pueblo",
                "pueblo",
                "pueblo",
                "pueblo",
                "pueblo",
                "pueblo",
                "muestra",
                "muestra",
                "muestra",
                "muestra",
                "muestra",
                "muestra",
                "muestra",
                "filme",
                "filme",
                "filme",
                "filme",
                "filme",
                "filme",
                "filme",
                "retrata",
                "retrata",
                "retrata",
                "retrata",
                "retrata",
                "retrata",
                "comunidad",
                "comunidad",
                "comunidad",
                "comunidad",
                "comunidad",
                "comunidad",
                "proceso",
                "proceso",
                "proceso",
                "proceso",
                "proceso",
                "nacional",
                "nacional",
                "nacional",
                "nacional",
                "nacional",
                "autoridades",
                "autoridades",
                "autoridades",
                "autoridades",
                "autoridades",
                "vida",
                "vida",
                "vida",
                "vida",
                "testimonios",
                "testimonios",
                "testimonios",
                "testimonios",
                "sociedad",
                "sociedad",
                "sociedad",
                "sociedad",
                "social",
                "social",
                "social",
                "social",
                "situación",
                "situación",
                "situación",
                "situación",
                "registra",
                "registra",
                "registra",
                "registra",
                "organización",
                "organización",
                "organización",
                "organización",
                "música",
                "música",
                "música",
                "música",
                "municipal",
                "municipal",
                "municipal",
                "municipal",
                "mujer",
                "mujer",
                "mujer",
                "mujer",
                "historia",
                "historia",
                "historia",
                "historia",
                "fílmicos",
                "fílmicos",
                "fílmicos",
                "fílmicos",
                "escolares",
                "escolares",
                "escolares",
                "escolares",
                "ejercicios",
                "ejercicios",
                "ejercicios",
                "ejercicios",
                "cuec",
                "cuec",
                "cuec",
                "cuec",
                "ciudad",
                "ciudad",
                "ciudad",
                "ciudad",
                "catálogo",
                "catálogo",
                "catálogo",
                "catálogo",
                "1989",
                "1989",
                "1989",
                "1989",
                "1988",
                "1988",
                "1988",
                "1988",
                "1963",
                "1963",
                "1963",
                "1963",
                "trabajadores",
                "trabajadores",
                "trabajadores",
                "sierra",
                "sierra",
                "sierra",
                "salvador",
                "salvador",
                "salvador",
                "salud",
                "salud",
                "salud",
                "palacio",
                "palacio",
                "palacio",
                "país",
                "país",
                "país",
                "octubre",
                "octubre",
                "octubre",
                "norte",
                "norte",
                "norte",
                "lucha",
                "lucha",
                "lucha",
                "indígena",
                "indígena",
                "indígena",
                "indígena",
                "indígena",
                "indígena",
                "grupo",
                "grupo",
                "grupo",
                "espacios",
                "espacios",
                "espacios",
                "elaboración",
                "elaboración",
                "elaboración",
                "cine",
                "cine",
                "cine",
                "casa",
                "casa",
                "casa",
                "banda",
                "banda",
                "banda",
                "aspectos",
                "aspectos",
                "aspectos",
                "zapotecas",
                "zapotecas",
                "zapotecas",
                "zapotecas",
                "youtube",
                "youtube",
                "yerid",
                "yerid",
                "xantolo",
                "xantolo",
                "vía",
                "vía",
                "veracruz",
                "veracruz",
                "vecindades",
                "vecindades",
                "universitarias",
                "universitarias",
                "universidad",
                "universidad",
                "unión",
                "unión",
                "torno",
                "torno",
                "testimonio",
                "testimonio",
                "tequio",
                "tequio",
                "stunam",
                "stunam",
                "sonia",
                "sonia",
                "sinopsis",
                "sinopsis",
                "sindicato",
                "sindicato",
                "retrato",
                "retrato",
                "relación",
                "relación",
                "relaciones",
                "relaciones",
                "región",
                "región",
                "realidad",
                "realidad",
                "puestas",
                "puestas",
                "pueblos",
                "pueblos",
                "producción",
                "producción",
                "posterior",
                "posterior",
                "porqué",
                "porqué",
                "populares",
                "populares",
                "popular",
                "popular",
                "política",
                "política",
                "poeta",
                "poeta",
                "petrolera",
                "petrolera",
                "partes",
                "partes",
                "papel",
                "papel",
                "oaxaca",
                "oaxaca",
                "norteamericana",
                "norteamericana",
                "nezahualcóyotl",
                "nezahualcóyotl",
                "movimiento",
                "movimiento",
                "mostrar",
                "mostrar",
                "mirada",
                "mirada",
                "migrantes",
                "migrantes",
                "mezcla",
                "mezcla",
                "mateo",
                "mateo",
                "martha",
                "martha",
                "marido",
                "marido",
                "mar",
                "mar",
                "logros",
                "logros",
                "junio",
                "junio",
                "invasión",
                "invasión",
                "incluye",
                "incluye",
                "imperialismo",
                "imperialismo",
                "imágenes",
                "imágenes",
                "huasteca",
                "huasteca",
                "histórico",
                "histórico",
                "fritz",
                "fritz",
                "ficción",
                "ficción",
                "época",
                "época",
                "escombros",
                "escombros",
                "entrevistas",
                "entrevistas",
                "elaborada",
                "elaborada",
                "económica",
                "económica",
                "doméstico",
                "doméstico",
                "diversos",
                "diversos",
                "desarrollo",
                "desarrollo",
                "defensa",
                "defensa",
                "declaraciones",
                "declaraciones",
                "cotidianidad",
                "cotidianidad",
                "cotidianas",
                "cotidianas",
                "cotidiana",
                "cotidiana",
                "comunitario",
                "comunitario",
                "colonias",
                "colonias",
                "colonia",
                "colonia",
                "colmenares",
                "colmenares",
                "celebraciones",
                "celebraciones",
                "captura",
                "captura",
                "canal",
                "canal",
                "campamento",
                "campamento",
                "beneficio",
                "beneficio",
                "barro",
                "barro",
                "autónoma",
                "autónoma",
                "años",
                "años",
                "año",
                "año",
                "actividades",
                "actividades",
                "acompaña",
                "acompaña",
                "1985",
                "1985",
                "1977",
                "1977",
                "1972",
                "1972",
                "19",
                "19",
                "zapotecos",
                "zaloamati",
                "zabludovsky",
                "yucatán",
                "york",
                "yalálag",
                "yalaltecas",
                "xx",
                "xavier",
                "wixárika",
                "vuelven",
                "voluntarias",
                "víctima",
                "vías",
                "vivieron",
                "vive",
                "virikuta",
                "violencia",
                "violador",
                "violación",
                "villaurrutia",
                "viejas",
                "video",
                "vicios",
                "vertiginoso",
                "venta",
                "vaquita",
                "valioso",
                "vacío",
                "única",
                "urbano",
                "universitarios",
                "unir",
                "unidos",
                "unam",
                "uec",
                "uam",
                "trueque",
                "triunfo",
                "trayectoria",
                "transporte",
                "transforma",
                "tramo",
                "trajo",
                "tradiciones",
                "trabajos",
                "trabajador",
                "tlalpan",
                "tierras",
                "textual",
                "textos",
                "texaco",
                "terrenos",
                "tepehua",
                "teófila",
                "temblores",
                "temas",
                "tejedoras",
                "tejedora",
                "tecnología",
                "techo",
                "taller",
                "sureste",
                "sucedida",
                "sismo",
                "sincretismo",
                "siglo",
                "siente",
                "sexualidad",
                "sexenio",
                "setenta",
                "sesenta",
                "septiembre",
                "señalan",
                "sentido",
                "semana",
                "secuencias",
                "sectores",
                "santos",
                "santa",
                "salvadoreña",
                "salario",
                "sala",
                "sagradas",
                "sacado",
                "roque",
                "roma",
                "rollo",
                "rituales",
                "ritos",
                "riesgos",
                "revolución",
                "revolucionario",
                "revolucionaria",
                "revictimización",
                "reunir",
                "resuelta",
                "respondiendo",
                "requisitos",
                "república",
                "reprimidas",
                "representante",
                "repositorio",
                "reportaje",
                "reporta",
                "renta",
                "remuneración",
                "religioso",
                "relatar",
                "relata",
                "regularización",
                "registro",
                "reflexiones",
                "reeducación",
                "recuperación",
                "recreación",
                "reconstrucción",
                "reconocimiento",
                "recoger",
                "recién",
                "rechazo",
                "realizando",
                "realizadas",
                "realiza",
                "radicalización",
                "pública",
                "pulgarcito",
                "puerto",
                "proyecto",
                "provocaron",
                "protagónico",
                "prostitución",
                "propiciando",
                "promete",
                "prohibidas",
                "progreso",
                "profundamente",
                "profesional",
                "productos",
                "productores",
                "producciones",
                "procesos",
                "problema",
                "presenta",
                "preparativos",
                "premio",
                "pregunta",
                "precios",
                "pp",
                "potosí",
                "posee",
                "portillo",
                "policía",
                "policial",
                "poesía",
                "poderosa",
                "población",
                "plantea",
                "peyote",
                "petróleo",
                "petroleros",
                "petición",
                "pescadores",
                "perspectiva",
                "personas",
                "personal",
                "persistente",
                "peregrina",
                "penal",
                "película",
                "particularmente",
                "participaron",
                "participantes",
                "partera",
                "palafox",
                "oro",
                "oriente",
                "organizan",
                "organizado",
                "organizaciones",
                "orden",
                "orales",
                "opiniones",
                "opep",
                "ollas",
                "oficio",
                "off",
                "ocuparon",
                "ochoa",
                "obtienen",
                "obstante",
                "obra",
                "obligatorio",
                "objeto",
                "objetivos",
                "oaxaqueño",
                "noticiario",
                "nombradas",
                "nixtamal",
                "nivel",
                "nicaragüense",
                "nicaragua",
                "nefastas",
                "necesidad",
                "naturales",
                "narrativa",
                "narración",
                "nandino",
                "nahua",
                "músicos",
                "muertos",
                "movilización",
                "mostrarlos",
                "mortandad",
                "moralmente",
                "monopolios",
                "molino",
                "mixteca",
                "mitad",
                "miras",
                "miguel",
                "migración",
                "mexicano",
                "mexicanas",
                "mexicana",
                "metropolitana",
                "metalúrgicos",
                "metalúrgicas",
                "metales",
                "mención",
                "mejores",
                "medios",
                "mediática",
                "mayas",
                "matrimonio",
                "material",
                "martín",
                "marcha",
                "mantener",
                "manos",
                "maíz",
                "lúcido",
                "luis",
                "logra",
                "locaciones",
                "llamado",
                "literaria",
                "lectura",
                "latinoamericano",
                "lanzamientos",
                "labores",
                "laboral",
                "kilómetros",
                "julio",
                "juárez",
                "joven",
                "jornada",
                "jalisciense",
                "jacobo",
                "iztacalco",
                "involucrados",
                "invadieron",
                "invadidos",
                "intervención",
                "interpretar",
                "interpretan",
                "intermediarios",
                "interétnicas",
                "integrantes",
                "instituto",
                "institucional",
                "inicios",
                "ingresos",
                "ingenieros",
                "ingeniería",
                "información",
                "inflación",
                "infantil",
                "inédita",
                "industrias",
                "industrial",
                "industria",
                "incluyendo",
                "incendio",
                "importante",
                "impartida",
                "ilustra",
                "ikoots",
                "ideológico",
                "ideología",
                "identidad",
                "huelguistas",
                "huelga",
                "hostigamiento",
                "hornos",
                "horno",
                "honran",
                "hombres",
                "historias",
                "hijos",
                "hidalgo",
                "hermanas",
                "hegemónicos",
                "hechos",
                "habitante",
                "guadalupe",
                "gobierno",
                "gestora",
                "generó",
                "gasto",
                "gasolina",
                "ganancias",
                "fundado",
                "función",
                "funcionarios",
                "fuerza",
                "fuente",
                "fotográfico",
                "formación",
                "forma",
                "forjado",
                "fílmico",
                "finalizó",
                "filmación",
                "fiestas",
                "fiesta",
                "ficcionado",
                "festividad",
                "festival",
                "femenina",
                "familias",
                "familia",
                "extranjera",
                "extracción",
                "exterior",
                "expuestos",
                "expropiación",
                "expresa",
                "exposición",
                "exponen",
                "explotación",
                "explora",
                "explicación",
                "experta",
                "experiencias",
                "expediente",
                "existencial",
                "evitar",
                "estudiantes",
                "estadounidense",
                "específicamente",
                "eslabón",
                "escuela",
                "escritores",
                "escribir",
                "escenas",
                "errores",
                "entrevistadora",
                "enriquece",
                "enormes",
                "enfrentan",
                "enero",
                "encontrará",
                "encarceladas",
                "emanadas",
                "elías",
                "eléctrico",
                "elementos",
                "elemento",
                "ejercer",
                "ejercen",
                "ejerce",
                "educación",
                "ecuatoriano",
                "dominio",
                "dominantes",
                "documentarlos",
                "documentalista",
                "dividida",
                "diversas",
                "distinta",
                "disputa",
                "dirigentes",
                "directores",
                "directa",
                "difuntos",
                "difundió",
                "diccionario",
                "diaria",
                "dgac",
                "década",
                "débil",
                "destruidos",
                "destacando",
                "despojo",
                "desplazar",
                "desierto",
                "deseaban",
                "descubrimiento",
                "desarrollado",
                "demuestran",
                "delito",
                "delegación",
                "dedicados",
                "decena",
                "danza",
                "dalton",
                "cumplido",
                "cultural",
                "cultura",
                "cuestiones",
                "cuerpos",
                "cubriendo",
                "cuadro",
                "cruzadas",
                "creativo",
                "crearon",
                "cotidianeidad",
                "costureras",
                "costumbres",
                "costo",
                "cortometraje",
                "corto",
                "coproducción",
                "cooperativista",
                "cooperativa",
                "convierten",
                "convenciones",
                "control",
                "contemporáneos",
                "construir",
                "construcción",
                "consiguiendo",
                "consejo",
                "conocido",
                "congelada",
                "condiciones",
                "condicionamiento",
                "conacyt",
                "comunitarias",
                "comunidades",
                "comunicación",
                "composiciones",
                "completar",
                "completa",
                "complementa",
                "complejas",
                "compañía",
                "compañeros",
                "comité",
                "comisión",
                "comienzo",
                "comerciantes",
                "combina",
                "colonos",
                "colectivo",
                "cohamiata",
                "cofán",
                "cocción",
                "cobre",
            ];

            const fontFamily = "Be Vietnam Pro";
            const fontScale = 40;
            const padding = 3;
            const height = 650; // TO DO: Diseño responsivo: ajustar ancho y alto para dispositivos móviles
            const width = 900;
            const rotate = d => Math.random() > 0.5 ? Math.random() * 0 : 90;

            var data = d3.rollups(
                words,
                (group) => group.length,
                (w) => w
            )
            .sort(([, a], [, b]) => d3.descending(a, b))
            .slice(0, 250)
            .map(([text, value]) => ({ text, value }));

            const colorScale = d3.scaleOrdinal()
            .domain([0, 1])
            .range(['white', 'black']); // TO DO: Usar colores rojos

            const svg = d3
                .select(this.$refs.chartContainer)
                .append("svg")
                .attr("height", height) // Altura del texto
                .attr("width", width) // Ancho del texto
                .attr("font-family", fontFamily) // Fuente del texto
                .attr("text-anchor", "middle") // Alinear el texto
                .attr("cursor", "pointer") // Se agrega cursor
                .on("click", (d) => console.log("Redireccion: ", d.srcElement.innerHTML)) // Agregar funcion de click
                .on("mouseover", (d) => console.log("Hover: ", d)) // Agregar funcion de hover

            const w_cloud = cloud()
            .size([width, height])
            .words(data.map((d) => Object.create(d)))
            .padding(padding)
            .rotate(rotate)
            .font(fontFamily)
            .fontSize((d) => Math.random(10, 10) * fontScale) // TO DO: Tamaño según frecuencia/repetición del término
            .on("word", ({ size, x, y, rotate, text }) => {
            svg
                .append("text")
                .attr("font-size", size) // Tamaño de la palabra
                .attr("transform", `translate(${x},${y}) rotate(${rotate})`) // Posicion de la palabra
                .text(text) // Texto
                .attr("fill", d => colorScale(Math.random())) // Cambiar color de las palabras
            })
            w_cloud.start();
        }
    }
</script>